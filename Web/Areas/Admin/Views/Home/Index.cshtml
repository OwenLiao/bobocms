



@{Layout = null;}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewBag.Title</title>


    <script src="~/lib/jquery/dist/jquery.js"></script>
    @Styles.Render("~/Scripts/easyui/themes/icon.css")
    @Styles.Render("~/Scripts/easyui/themes/bootstrap/easyui.css")
    @Scripts.Render("~/bundles/jquery", "~/bundles/easyui")
    @Styles.Render("~/Areas/Admin/Content/Css/base.css")
</head>
<body class="easyui-layout">


    <script>

        $(function () {
            tabClose();
            tabCloseEven();

            $('#css3menu a').click(function () {
                $('#css3menu a').removeClass('active');
                $(this).addClass('active');

                var d = _menus[$(this).attr('name')];
                Clearnav();
                addNav(d);
                InitLeftMenu();
            });

            // �����˵��󶨳�ʼ��
            $("#wnav").accordion({
                animate: false
            });

            //var firstMenuName = $('#css3menu a:first').attr('name');
            //addNav(_menus[firstMenuName]);
            InitLeftMenu();
        });

        function Clearnav() {
            var pp = $('#wnav').accordion('panels');

            $.each(pp, function (i, n) {
                if (n) {
                    var t = n.panel('options').title;
                    $('#wnav').accordion('remove', t);
                }
            });

            pp = $('#wnav').accordion('getSelected');
            if (pp) {
                var title = pp.panel('options').title;
                $('#wnav').accordion('remove', title);
            }
        }

        function addNav(data) {

            $.each(data, function (i, sm) {
                var menulist = "";
                menulist += '<ul>';
                $.each(sm.menus, function (j, o) {
                    menulist += '<li><div><a ref="' + o.menuid + '" href="#" rel="'
                            + o.url + '" ><span class="icon ' + o.icon
                            + '" >&nbsp;</span><span class="nav">' + o.menuname
                            + '</span></a></div></li> ';
                });
                menulist += '</ul>';

                $('#wnav').accordion('add', {
                    title: sm.menuname,
                    content: menulist,
                    iconCls: 'icon ' + sm.icon
                });

            });

            var pp = $('#wnav').accordion('panels');
            var t = pp[0].panel('options').title;
            $('#wnav').accordion('select', t);

        }

        // ��ʼ�����
        function InitLeftMenu() {

            hoverMenuItem();

            $('#wnav li a').live('click', function () {
                var tabTitle = $(this).children('.nav').text();

                var url = $(this).attr("rel");
                var menuid = $(this).attr("ref");
                var icon = getIcon(menuid, icon);

                addTab(tabTitle, url, icon);
                $('#wnav li div').removeClass("selected");
                $(this).parent().addClass("selected");
            });

        }

        /**
         * �˵������Hover
         */
        function hoverMenuItem() {
            $(".easyui-accordion").find('a').hover(function () {
                $(this).parent().addClass("hover");
            }, function () {
                $(this).parent().removeClass("hover");
            });
        }

        // ��ȡ��ർ����ͼ��
        function getIcon(menuid) {
            var icon = 'icon ';
            $.each(_menus, function (i, n) {
                $.each(n, function (j, o) {
                    $.each(o.menus, function (k, m) {
                        if (m.menuid == menuid) {
                            icon += m.icon;
                            return false;
                        }
                    });
                });
            });
            return icon;
        }

        function addTab(subtitle, url, icon) {
            if (!$('#tabs').tabs('exists', subtitle)) {
                $('#tabs').tabs('add', {
                    title: subtitle,
                    content: createFrame(url),
                    closable: true,
                    icon: icon
                });
            } else {
                $('#tabs').tabs('select', subtitle);
                $('#mm-tabupdate').click();
            }
            tabClose();
        }

        function createFrame(url) {
            var s = '<iframe scrolling="auto" frameborder="0"  src="' + url + '" style="width:100%;height:100%;"></iframe>';
            return s;
        }

        function tabClose() {
            /* ˫���ر�TABѡ� */
            $(".tabs-inner").dblclick(function () {
                var subtitle = $(this).children(".tabs-closable").text();
                $('#tabs').tabs('close', subtitle);
            });
            /* Ϊѡ����Ҽ� */
            $(".tabs-inner").bind('contextmenu', function (e) {
                $('#mm').menu('show', {
                    left: e.pageX,
                    top: e.pageY
                });

                var subtitle = $(this).children(".tabs-closable").text();

                $('#mm').data("currtab", subtitle);
                $('#tabs').tabs('select', subtitle);
                return false;
            });
        }
        // ���Ҽ��˵��¼�
        function tabCloseEven() {
            // ˢ��
            $('#mm-tabupdate').click(function () {
                var currTab = $('#tabs').tabs('getSelected');
                var url = $(currTab.panel('options').content).attr('src');
                $('#tabs').tabs('update', {
                    tab: currTab,
                    options: {
                        content: createFrame(url)
                    }
                });
            });
            // �رյ�ǰ
            $('#mm-tabclose').click(function () {
                var currtab_title = $('#mm').data("currtab");
                $('#tabs').tabs('close', currtab_title);
            });
            // ȫ���ر�
            $('#mm-tabcloseall').click(function () {
                $('.tabs-inner span').each(function (i, n) {
                    var t = $(n).text();
                    $('#tabs').tabs('close', t);
                });
            });
            // �رճ���ǰ֮���TAB
            $('#mm-tabcloseother').click(function () {
                $('#mm-tabcloseright').click();
                $('#mm-tabcloseleft').click();
            });
            // �رյ�ǰ�Ҳ��TAB
            $('#mm-tabcloseright').click(function () {
                var nextall = $('.tabs-selected').nextAll();
                if (nextall.length == 0) {
                    // msgShow('ϵͳ��ʾ','���û����~~','error');
                    alert('���û����~~');
                    return false;
                }
                nextall.each(function (i, n) {
                    var t = $('a:eq(0) span', $(n)).text();
                    $('#tabs').tabs('close', t);
                });
                return false;
            });
            // �رյ�ǰ����TAB
            $('#mm-tabcloseleft').click(function () {
                var prevall = $('.tabs-selected').prevAll();
                if (prevall.length == 0) {
                    alert('��ͷ�ˣ�ǰ��û����~~');
                    return false;
                }
                prevall.each(function (i, n) {
                    var t = $('a:eq(0) span', $(n)).text();
                    $('#tabs').tabs('close', t);
                });
                return false;
            });

            // �˳�
            $("#mm-exit").click(function () {
                $('#mm').menu('hide');
            });
        }

        // ������Ϣ���� title:���� msgString:��ʾ��Ϣ msgType:��Ϣ���� [error,info,question,warning]
        function msgShow(title, msgString, msgType) {
            $.messager.alert(title, msgString, msgType);
        }

        // ����ʱ��
        function clockon() {
            var now = new Date();
            var year = now.getFullYear(); // getFullYear getYear
            var month = now.getMonth();
            var date = now.getDate();
            var day = now.getDay();
            var hour = now.getHours();
            var minu = now.getMinutes();
            var sec = now.getSeconds();
            var week;
            month = month + 1;
            if (month < 10)
                month = "0" + month;
            if (date < 10)
                date = "0" + date;
            if (hour < 10)
                hour = "0" + hour;
            if (minu < 10)
                minu = "0" + minu;
            if (sec < 10)
                sec = "0" + sec;
            var arr_week = new Array("������", "����һ", "���ڶ�", "������", "������", "������", "������");
            week = arr_week[day];
            var time = "";
            time = year + "��" + month + "��" + date + "��" + " " + hour + ":" + minu
                    + ":" + sec + " " + week;

            $("#bgclock").html(time);

            var timer = setTimeout("clockon()", 200);
        }

    </script>


    <script type="text/javascript">
        var _menus = "";
        var _menus = {
            basic: [{
                "menuid": "10",
                "icon": "icon-sys",
                "menuname": "��������",
                "menus": [{
                    "menuid": "111",
                    "menuname": "��������1",
                    "icon": "icon-nav",
                    "url": "#"
                }, {
                    "menuid": "113",
                    "menuname": "��������12",
                    "icon": "icon-nav",
                    "url": "#"
                }, {
                    "menuid": "115",
                    "menuname": "��������13",
                    "icon": "icon-nav",
                    "url": "#"
                }, {
                    "menuid": "117",
                    "menuname": "��������14",
                    "icon": "icon-nav",
                    "url": "#"
                }, {
                    "menuid": "119",
                    "menuname": "��������15",
                    "icon": "icon-nav",
                    "url": "em/enterpriseChannelObtend.action"
                }]
            }, {
                "menuid": "20",
                "icon": "icon-sys",
                "menuname": "����һ",
                "menus": [{
                    "menuid": "211",
                    "menuname": "����һ11",
                    "icon": "icon-nav",
                    "url": "#"
                }, {
                    "menuid": "213",
                    "menuname": "����һ22",
                    "icon": "icon-nav",
                    "url": "#"
                }]
            }],
            point: [{
                "menuid": "20",
                "icon": "icon-sys",
                "menuname": "���ֹ���",
                "menus": [{
                    "menuid": "211",
                    "menuname": "������;",
                    "icon": "icon-nav",
                    "url": "#"
                }, {
                    "menuid": "213",
                    "menuname": "���ֵ���",
                    "icon": "icon-nav",
                    "url": "#"
                }]

            }]
        };
        //���õ�¼����
        function openPwd() {
            $('#w').window({
                title: '�޸�����',
                width: 300,
                modal: true,
                shadow: true,
                closed: true,
                height: 160,
                resizable: false
            });
        }
        //�رյ�¼����
        function closePwd() {
            $('#w').window('close');
        }



        //�޸�����
        function serverLogin() {
            var $newpass = $('#txtNewPass');
            var $rePass = $('#txtRePass');

            if ($newpass.val() == '') {
                msgShow('ϵͳ��ʾ', '���������룡', 'warning');
                return false;
            }
            if ($rePass.val() == '') {
                msgShow('ϵͳ��ʾ', '����һ���������룡', 'warning');
                return false;
            }

            if ($newpass.val() != $rePass.val()) {
                msgShow('ϵͳ��ʾ', '�������벻һ��������������', 'warning');
                return false;
            }

            $.post('/ajax/editpassword.ashx?newpass=' + $newpass.val(), function (msg) {
                msgShow('ϵͳ��ʾ', '��ϲ�������޸ĳɹ���<br>����������Ϊ��' + msg, 'info');
                $newpass.val('');
                $rePass.val('');
                close();
            })

        }

        $(function () {

            openPwd();

            $('#editpass').click(function () {
                $('#w').window('open');
            });

            $('#btnEp').click(function () {
                serverLogin();
            })

            $('#btnCancel').click(function () { closePwd(); })

            $('#loginOut').click(function () {
                $.messager.confirm('ϵͳ��ʾ', '��ȷ��Ҫ�˳����ε�¼��?', function (r) {

                    if (r) {
                        location.href = '/ajax/loginout.ashx';
                    }
                });
            })
        });



    </script>


    <div region="north" split="true" border="false" style="height:60px;background:#B3DFDA;padding:10px">
        <span style="float:right; padding-right:20px;" class="head">��ӭ ������ <a href="#" id="editpass">�޸�����</a> <a href="#" id="loginOut">��ȫ�˳�</a></span>

        <span style="padding-left:10px; font-size: 16px; float:left;"><img src="" width="20" height="20" align="absmiddle" /> �ҵ��ʱ�</span>
        <ul id="css3menu" style="padding:0px; margin:0px;list-type:none; float:left; margin-left:40px;">
            <li><a class="active" name="basic" href="javascript:;" title="��������">��������</a></li>
            <li><a name="point" href="javascript:;" title="���ֹ���">���ֹ���</a></li>

        </ul>
    </div>
    <div region="south" split="true" style="height: 30px; background: #D2E0F2; ">
        <div class="footer"></div>
    </div>
    <div region="west" hide="true" split="true" title="�����˵�" style="width:180px;" id="west">
        <div id='wnav' class="easyui-accordion" fit="true" border="false">
            <!--  �������� -->
            @Html.Action("Menu")
        </div>

    </div>
    <div id="mainPanle" region="center" style="background: #eee; overflow-y:hidden">
        <div id="tabs" class="easyui-tabs" fit="true" border="false">
            <div title="��ӭʹ��" style="padding:20px;overflow:hidden;" id="home">

                <h1>Welcome to using The jQuery EasyUI!</h1>

            </div>
        </div>
    </div>




    <div id="mm" class="easyui-menu" style="width:150px;">
        <div id="mm-tabupdate">ˢ��</div>
        @*<div class="menu-sep"></div>*@
        <div id="mm-tabclose">�ر�</div>
        <div id="mm-tabcloseall">ȫ���ر�</div>
        <div id="mm-tabcloseother">����֮��ȫ���ر�</div>
        @*<div class="menu-sep"></div>
            <div id="mm-tabcloseright">��ǰҳ�Ҳ�ȫ���ر�</div>
            <div id="mm-tabcloseleft">��ǰҳ���ȫ���ر�</div>
            <div class="menu-sep"></div>
            <div id="mm-exit">�˳�</div>*@
    </div>


</body>
</html>